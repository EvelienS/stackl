version: '3.3'
networks:
  default:
    external:
      name: stackl
  outside:
    external:
      name: "host"
services:
  stackl-agent:
    restart: always
    image: registry.gitlab.com/stackl-core/v2/stackl2/stackl_agent
    container_name: stackl_agent   #this is ignored in swarm mode
    deploy:
      replicas: 1
      update_config:
        parallelism: 1
        delay: 10s
    networks:
     - default
    volumes:
      - /stackl-efs/stackl-certs:/certs/
      - /stackl-efs/stackl-crl:/crl/
    ports:
       - 8889:8889
    environment:
      - STACKL_LOGPATH=/var/log/stackl.log
      - STACKL_STACKLRESTHOST=stackl-rest
      - TCP_PORTS=8889
      - SERVICE_PORTS="80"
      - STACKL_CACERT=/certs/ca.crt
      - STACKL_PKIHOST=stackl.stackl.io
      - STACKL_PKIPORT=8443
      - STACKL_PKICA=intermCA
